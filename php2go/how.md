# 在 php 转 go 的部门我做了哪些准备

## PHP转 go 应该怎么做
    很多公司都听说过, 也可能想过。但是执行起来，可能困难重重。 这里我谈一些经验。 
  如果是一个业务型团队， 各种需求忙不完，那还是不要转了。 golang 是个性能型语言，
  但是，和 php 比会是一个低产出的语言，会降低生产力。尤其是，现有的 phper，
  写出来的golang 带着 php 思路，也没有什么性能可言。
  

  * 要变成一个学习型团队，挺难.大部分人不适合转型.
  * 招聘专职的 golang 团队, 这是必须的。难点在于找到一个准架构师能力的人。否则路径规划比较困难。
  * 业务拆分， 适合 php 的是一部分， 适合 golang 的是另一部分。这个应该不难。
  * 引入云基础设施，比如 k8s， 以及伴随 k8s 存在的构建部署系统。这个比较简单。
  * 引入 rpc， 或者 api 打通 php 和 golang 之间的桥梁。引入兼容 json 库
  * 引入数据库和缓存库。很多迁移需要共同修改或者存储相同资源。
  * 磨合团队， 增加出错容忍度。

## 第一个工程不一定成功
  * 总要有一个机会，让 php 的一些工程做成一个简单的服务，让两个团队融合。而这个目标可能就不是一个出彩的事情。
    只是让成员们，相互理解，能够共同合作。 跑通流程，解决一个 php 实现起来比较困难的问题就可以了。 
    一般多进程实现困难的事情都可以
      
  * 其实这个过程，能看出谁是可以写代码的。给一个例子就能很快模仿出来的都不错。 有的人就会磕磕绊绊，有的就会思考不全。
 比较容易出现 bug。有一些人就是嘴上说的很好，实际上写起来就是眼高手低。很难走上规范化道路。放下现有的认知，才能学到更多
    总是放在自己的梦想里，写一些让 phper 看着 niublity 实际上在 golang 这边也不值得一提的事情。
    
## 第二个工程会有比较大的收益
  * 有了第一个工程的共识，很多 php 解决不了的问题就会浮现出来。不同公司也不一样，但是优势的背后就有巨大风险，
缺乏运维经验，很多都是摸石头过河。注意 php 端， 可能遇到大坑。反正我们是遇到了。 这也是看你招的 golang 
    的人有没有能力的时候了，也有可能遇到这个挫折，就直接让公司不再转了。当时我们遇到的事情还是比较大的，
    停机了好几个小时，对golang 的预期过高了。 我还是用非常规的设计思路，把这个事情解决了。性能也达到了预期。
    
  * 当然，停止转型也是一个受益。我后来也面试过各种想转 golang 的公司，其实他们的领导也没经验，也没能力。
    就是一个想法。公司现有的语言，无论是 php， ruby， 都开发到瓶颈了。其实他们要解决的都不是转
    golang 的问题。换上 golang 也一样的烂。还是请个架构师吧。
    
  * 我按照 php 到 golang， 相同的思路，相同的实现方法，做了一个试验，性能没有提升。只有针对现有影响性能
    的点进行优化，才达到了低负载，高性能的实现。大多数公司应该耗在效果不明显的路上。
    
## 长期过度还是速战速决
  * 后面基本上所有公司都进入了持久战， php 放不下，还要维护， golang 也没法重投入去刷新设计。除了找不到高手以外，
人力成本也是基本难以承受。
    
## 我做了什么规划

*  公司架构， 从 lnmp下手， 在 n 层进行介入 golang 的 caddy， 在 l 层增加，php 服务的伴随本机 golang 服务
这样，从流量层对 php 进行了保护，最后用 docker 加持， php 可以保持他最优秀的部分。 而 golang 也可以最小成本
   的介入到 php 的前面和后面。预处理和后处理都搞定了。也就不怕什么了。 这部分倒是可以整理出来。
   
* 语言翻译， 几十万行代码的 php，人工重构是困难的。借助开源的力量，可以完成 php 的语法解析器。 然后直接翻译
成 golang 的语法，这样用更小的成本就可以完成 php 的重构，就然后这部分，试验是比较轻松的。因为底层函数的不一致，
  短时间内也不可能速成。 根据公司现有的代码，完成一个低成本的翻译工具，还是可行的。需要有一个对编译原理比较熟悉的人。
  当然可遇不可求，如果你是这样的人，咱们可以继续这个工作。
  
## 写在最后
敬畏一种语言，像敬畏一棵树一样。

https://github.com/z7zmey/php-parser
https://github.com/stephens2424/php

